<!--
@file: docs/tasktracker.md
@description: Трекер задач проекта MksDdn Collection for Postman
@dependencies: docs/Project.md
@created: 2025-08-19
-->

## Задача: Инициализация документации
- **Статус**: Завершена
- **Описание**: Создать базовые документы в `docs/`.
- **Шаги выполнения**:
  - [x] Создать `Project.md`
  - [x] Создать `tasktracker.md`
  - [x] Создать `changelog.md`
  - [x] Создать `Diary.md`
  - [x] Создать `qa.md`
- **Зависимости**: Нет

## Задача: Ответы на вопросы в QA
- **Статус**: Завершена
- **Описание**: Сформулировать и зафиксировать ответы в `docs/qa.md`.
- **Шаги выполнения**:
  - [x] Установить минимальные версии WP/PHP и Tested up to
  - [x] Определить slug/text-domain
  - [x] Выбрать лицензию и ссылки автора
  - [x] Решить по мультисайту, i18n, WP-CLI, capabilities
  - [x] Определить правила `.gitignore`
- **Зависимости**: Нет

## Задача: Приведение заголовков и метаданных плагина к требованиям PCP
- **Статус**: Завершена
- **Описание**: Обновить заголовки в `postman-collection.php`, добавить `Text Domain`, версии WP/PHP, лицензию.
- **Шаги выполнения**:
  - [x] Добавить `Requires at least`, `Tested up to`, `Requires PHP`
  - [x] Добавить `Text Domain` и `Domain Path`
  - [x] Добавить `License` и `License URI`
  - [x] Проверить `Author`/`Author URI`
- **Зависимости**: Ответы в `docs/qa.md` (минимальные версии, лицензия)

## Задача: Интернационализация (i18n)
- **Статус**: В процессе
- **Описание**: Добавить поддержку переводов.
- **Шаги выполнения**:
  - [x] Ввести `load_plugin_textdomain`
  - [x] Обернуть пользовательские строки в `__()`/`_e()`
  - [x] Сгенерировать `.pot`
- **Зависимости**: Обновление заголовков (Text Domain)

## Задача: Экранирование и санитизация админ-формы
- **Статус**: Завершена
- **Описание**: Привести вывод/ввод к WPCS и рекомендациям PCP.
- **Шаги выполнения**:
  - [x] Полный проход по `class-postman-admin.php` на предмет `esc_attr`, `esc_html`, `esc_url`
  - [x] Санитизировать массивы `$_POST` при чтении
  - [x] Добавить `nonce`-поля на все действия (проверить текущие)
- **Зависимости**: Нет

## Задача: Readme.txt для WordPress.org
- **Статус**: Завершена
- **Описание**: Подготовить readme в формате каталога.
- **Шаги выполнения**:
  - [x] Описание, краткое описание, теги
  - [x] Раздел Installation/FAQ/Screenshots/Changelog
  - [x] Ссылки и совместимость
- **Зависимости**: Метаданные плагина

## Задача: Актуализация readme.txt
- **Статус**: Завершена
- **Описание**: Проверить и обновить readme.txt в соответствии с реальным функционалом плагина.
- **Шаги выполнения**:
  - [x] Исправить версию "Tested up to" с 6.8 на 6.6
  - [x] Обновить список функций с учетом всех реализованных возможностей
  - [x] Дополнить описание плагина более детальной информацией
  - [x] Расширить FAQ с новыми вопросами о ACF, файлах, фильтрах
  - [x] Улучшить примеры WP-CLI команд
- **Зависимости**: Нет

## Задача: Настроить PHPCS и PHPCompatibility (локально)
- **Статус**: В процессе
- **Описание**: Добавить локальные правила для код-стайла и совместимости.
- **Шаги выполнения**:
  - [x] Добавить `phpcs.xml.dist` с WPCS
  - [ ] Добавить PHPCompatibility правила
  - [ ] Настроить локальный pre-commit hook
- **Зависимости**: Нет

## Задача: Удалено — CI-проверки (PCP + PHPCS)
- **Статус**: Закрыта
- **Описание**: Решено не использовать CI. Проверки выполняются локально.
- **Шаги выполнения**:
  - [x] Исключить GitHub Actions из плана
- **Зависимости**: Нет

## Задача: Добавить WP-CLI команду экспорта
- **Статус**: Завершена
- **Описание**: Реализовать CLI-команду для экспорта коллекции.
- **Шаги выполнения**:
  - [x] Добавить класс `Postman_CLI`
  - [x] Зарегистрировать команду `wp mksddn-collection-for-postman export`
  - [x] Обновить `readme.txt` с примерами
- **Зависимости**: Нет

## Задача: Подготовка к публикации в SVN
- **Статус**: Не начата
- **Описание**: Подготовить структуру для SVN (`trunk/`, `tags/`).
- **Шаги выполнения**:
  - [ ] Сформировать содержимое каталога `mksddn-collection-for-postman`
  - [ ] Проверить readme и заголовки
  - [ ] Тест обновления на тестовом сайте
- **Зависимости**: Readme, PCP

## Задача: Uninstall обработчик
- **Статус**: Завершена
- **Описание**: Добавить безопасный `uninstall.php`.
- **Шаги выполнения**:
  - [x] Создать `uninstall.php` с проверкой `WP_UNINSTALL_PLUGIN`
  - [x] Задокументировать отсутствие удаляемых данных
- **Зависимости**: Нет

## Задача: WPCS: JSON и строгие сравнения
- **Статус**: Завершена
- **Описание**: Привести код к рекомендациям WPCS.
- **Шаги выполнения**:
  - [x] Заменить `json_encode` на `wp_json_encode`
  - [x] Включить strict-режим для `in_array()`
- **Зависимости**: Нет

## Задача: Фильтры расширения
- **Статус**: Завершена
- **Описание**: Добавить фильтры для кастомизации коллекции и имени файла.
- **Шаги выполнения**:
  - [x] `mksddn_postman_collection`
  - [x] `mksddn_postman_filename`
- **Зависимости**: Нет

## Задача: Условная смена namespace для форм
- **Статус**: Завершена
- **Описание**: Если активен `mksddn-forms-handler`, использовать `mksddn-forms-handler/v1/forms` вместо `wp/v2/forms` для list и submit.
- **Шаги выполнения**:
  - [x] Добавить проверку `is_plugin_active('mksddn-forms-handler/mksddn-forms-handler.php')`
  - [x] Обновить пути list и submit в `Postman_Routes::get_forms_routes`
  - [x] Обновить `docs/changelog.md`
- **Зависимости**: Нет

## Задача: Локальный прогон PCP
- **Статус**: Не начата
- **Описание**: Прогнать WordPress Plugin Check локально и устранить замечания.
- **Шаги выполнения**:
  - [ ] Прогон PCP
  - [ ] Исправить найденные замечания (если будут)
- **Зависимости**: Нет

## Задача: Нужно разделить class-postman-routes.php на отдельные компоненты.
- **Статус**: Не начата

## Задача: Генерация тестовых данных для форм (расширение типов)
- **Статус**: Завершена
- **Описание**: Добавить поддержку генерации примеров значений для всех распространённых типов полей формы, включая множественный выбор.
- **Шаги выполнения**:
  - [x] Вынести маппинг в приватный метод `generate_sample_value_for_field()`
  - [x] Поддержать типы: text, email, password, tel, url, number, date, time, datetime-local, textarea, checkbox, radio, select (multiple), file (multiple)
  - [x] Реализовать разбор `options` (строки и объекты `{value,label}`)
  - [x] Обновить `docs/Project.md`
- **Зависимости**: Активность `mksddn-forms-handler` влияет на namespace, не влияет на генерацию данных

## Задача: Добавить GET-роут информации для каждой формы
- **Статус**: Завершена
- **Описание**: Для каждой опубликованной формы добавлен GET-запрос `.../v1/forms/{slug}` рядом с POST `.../submit`.
- **Шаги выполнения**:
  - [x] Добавить элемент "Get Form Info - {title}" в `Postman_Routes::get_forms_routes()`
  - [x] Обновить `docs/Project.md` (перечень роутов форм)
- **Зависимости**: Наличие активного `mksddn-forms-handler`

## Задача: Перевести отправку форм с файлами на form-data
- **Статус**: В процессе
- **Описание**: Для роутов отправки форм, содержащих поля типа `file`, генератор коллекции должен использовать `Body → form-data` с полями типа File вместо `raw JSON`.
- **Шаги выполнения**:
  - [x] Проанализировать текущую генерацию роутов в `Postman_Routes::get_forms_routes()`
  - [ ] Переключить тело запроса на `form-data` и убрать явный заголовок `Content-Type: application/json`
  - [ ] Сгенерировать элементы `formdata` для текстовых и файловых полей (File/Text)
  - [x] Проверить линтер и обновить `docs/Project.md`
- **Зависимости**: Активность плагина `mksddn-forms-handler`

## Задача: Багфикс — обычные формы без файлов
- **Статус**: Завершена
- **Описание**: Для форм без файлов необходимо отправлять `application/json`. Добавлена условная установка заголовка.
- **Шаги выполнения**:
  - [x] Добавить условную установку заголовка `Content-Type: application/json` при отсутствии `file`-полей
  - [x] Проверить линтер
- **Зависимости**: Перевод форм с файлами на form-data

## Задача: Багфикс — Postman помечает raw как Text
- **Статус**: Завершена
- **Описание**: Для raw-тела нужно явное `options.raw.language: json`, иначе Postman трактует как Text.
- **Шаги выполнения**:
  - [x] Установить `options.raw.language = json` для raw-тел
  - [x] Проверить линтер
- **Зависимости**: Отправка обычных форм без файлов

## Задача: Багфикс — Options Pages папка добавляется даже без реальных страниц
- **Статус**: Завершена
- **Описание**: В коллекцию добавлялась папка "Options Pages" даже когда в админке нет реальных options pages (только example-* страницы).
- **Шаги выполнения**:
  - [x] Проанализировать логику в `Postman_Routes::get_options_routes()`
  - [x] Добавить проверку наличия реальных страниц (не example-*)
  - [x] Добавлять "List of Options Pages" только при наличии реальных страниц
  - [x] Протестировать исправление
  - [x] Обновить документацию
- **Зависимости**: Нет

## Задача: Исправление ошибки автоматической проверки WordPress.org
- **Статус**: Завершена
- **Описание**: Исправить ошибку "outdated_tested_upto_header" в readme.txt - обновить "Tested up to" с 6.6 до 6.8.
- **Шаги выполнения**:
  - [x] Обновить "Tested up to: 6.6" на "Tested up to: 6.8" в readme.txt
  - [x] Проверить совместимость плагина с WordPress 6.8
  - [x] Обновить документацию в tasktracker.md
- **Зависимости**: Нет

## Задача: Изменение названия коллекции Postman
- **Статус**: Завершена
- **Описание**: Изменить название коллекции с названия темы на адрес сайта для лучшей идентификации.
- **Шаги выполнения**:
  - [x] Изменить `get_bloginfo('name')` на `get_bloginfo('url')` в методе `get_collection_info()`
  - [x] Обновить документацию в tasktracker.md
- **Зависимости**: Нет

## Задача: Исправление baseUrl переменной
- **Статус**: Завершена
- **Описание**: Заменить хардкод baseUrl 'http://localhost:8000' на реальный URL сайта WordPress.
- **Шаги выполнения**:
  - [x] Заменить хардкод на `home_url()` в методе `get_variables()`
  - [x] Протестировать генерацию коллекции с новым baseUrl
  - [x] Обновить документацию в tasktracker.md
- **Зависимости**: Нет

## Задача: Изменение названия плагина для соответствия требованиям WordPress.org
- **Статус**: Завершена
- **Описание**: Изменить название плагина с "MksDdn Postman Collection" на "MksDdn Collection for Postman" и slug с "mksddn-postman-collection" на "mksddn-collection-for-postman" для избежания нарушения торговых марок.
- **Шаги выполнения**:
  - [x] Обновить Plugin Name в postman-collection.php
  - [x] Изменить Text Domain на mksddn-collection-for-postman
  - [x] Обновить WP-CLI команду на mksddn-collection-for-postman
  - [x] Обновить readme.txt с новым названием
  - [x] Обновить все файлы includes/ с новым text domain
  - [x] Переименовать файл языков на mksddn-collection-for-postman.pot
  - [x] Обновить документацию проекта
  - [x] Обновить версию плагина до 1.0.1
- **Зависимости**: Требования WordPress.org по торговым маркам

## Задача: Обновление версии плагина до 1.0.1
- **Статус**: Завершена
- **Описание**: Обновить версию плагина с 1.0.0 на 1.0.1 после изменения названия и slug.
- **Шаги выполнения**:
  - [x] Обновить версию в postman-collection.php (заголовок и константа)
  - [x] Обновить Stable tag в readme.txt
  - [x] Добавить запись в Changelog с описанием изменений
  - [x] Обновить Upgrade Notice
  - [x] Обновить версию в файле языков
  - [x] Обновить документацию в tasktracker.md
- **Зависимости**: Изменение названия плагина